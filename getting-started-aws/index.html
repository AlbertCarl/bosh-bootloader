



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.6.2">
    
    
      
        <title>Getting started aws - BBL</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.9b572555.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#getting-started-aws" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="BBL" class="md-header-nav__button md-logo">
          
            <img src="../theme/bosh.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                BBL
              </span>
              <span class="md-header-nav__topic">
                Getting started aws
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../theme/bosh.svg" width="24" height="24">
      
    </span>
    BBL
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="BOSH Bootloader" class="md-nav__link">
      BOSH Bootloader
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../advanced/" title="Advanced Configuration" class="md-nav__link">
      Advanced Configuration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cf-lbs/" title="`bbl up --lb-type cf`" class="md-nav__link">
      `bbl up --lb-type cf`
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cleanup-aws/" title="Cleaning up a BBL environment on AWS" class="md-nav__link">
      Cleaning up a BBL environment on AWS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../concourse/" title="Deploying Concourse" class="md-nav__link">
      Deploying Concourse
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../credhub/" title="Accessing the BOSH director credhub" class="md-nav__link">
      Accessing the BOSH director credhub
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Getting started aws
      </label>
    
    <a href="./" title="Getting started aws" class="md-nav__link md-nav__link--active">
      Getting started aws
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started-aws" title="Getting Started - AWS" class="md-nav__link">
    Getting Started - AWS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-an-iam-user" title="Creating an IAM user" class="md-nav__link">
    Creating an IAM user
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-infrastructure-and-bosh-director" title="Creating infrastructure and BOSH director" class="md-nav__link">
    Creating infrastructure and BOSH director
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-management" title="State management" class="md-nav__link">
    State management
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-to-the-bosh-director" title="Connecting to the BOSH director" class="md-nav__link">
    Connecting to the BOSH director
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alternatives-to-bbl-print-env" title="Alternatives to bbl print-env" class="md-nav__link">
    Alternatives to bbl print-env
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-azure/" title="Getting started azure" class="md-nav__link">
      Getting started azure
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-gcp/" title="Getting started gcp" class="md-nav__link">
      Getting started gcp
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../howto-ssh/" title="Howto ssh" class="md-nav__link">
      Howto ssh
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../known-issues/" title="Known issues" class="md-nav__link">
      Known issues
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started-aws" title="Getting Started - AWS" class="md-nav__link">
    Getting Started - AWS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-an-iam-user" title="Creating an IAM user" class="md-nav__link">
    Creating an IAM user
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-infrastructure-and-bosh-director" title="Creating infrastructure and BOSH director" class="md-nav__link">
    Creating infrastructure and BOSH director
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-management" title="State management" class="md-nav__link">
    State management
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-to-the-bosh-director" title="Connecting to the BOSH director" class="md-nav__link">
    Connecting to the BOSH director
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alternatives-to-bbl-print-env" title="Alternatives to bbl print-env" class="md-nav__link">
    Alternatives to bbl print-env
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Getting started aws</h1>
                
                <h3 id="getting-started-aws">Getting Started - AWS</h3>
<p>This guide is a walkthrough for deploying a BOSH director with <code>bbl</code>
on AWS. Upon completion, you will have the following:</p>
<ol>
<li>A BOSH director instance in the availability zone of your choice.</li>
<li>A set of randomly generated BOSH director credentials.</li>
<li>A generated keypair allowing you to SSH into the BOSH director and
any instances BOSH deploys.</li>
<li>A copy of the manifest the BOSH director was deployed with</li>
<li>A basic cloud config</li>
</ol>
<h3 id="creating-an-iam-user">Creating an IAM user</h3>
<p>In order for <code>bbl</code> to interact with AWS, an <code>IAM</code> user must be created.
This user will be issuing API requests to create the infrastructure such
as EC2 instances, load balancers, subnets, etc.</p>
<p>The user must have the following <code>policy</code>:</p>
<pre><code>{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Sid&quot;: &quot;VisualEditor0&quot;,
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;logs:*&quot;,
                &quot;elasticloadbalancing:*&quot;,
                &quot;cloudformation:*&quot;,
                &quot;iam:*',
                &quot;kms:*&quot;,
                &quot;route53:*&quot;,
                &quot;ec2:*&quot;
            ],
            &quot;Resource&quot;: &quot;*&quot;
        }
    ]
}
</code></pre>

<p>To create a user and associated policy with the AWS CLI run the 
following commands (policy text must be in your clipboard):</p>
<pre><code>$ aws iam create-user --user-name &quot;bbl-user&quot;
$ aws iam put-user-policy --user-name &quot;bbl-user&quot; \
    --policy-name &quot;bbl-policy&quot; \
    --policy-document &quot;$(pbpaste)&quot;
$ aws iam create-access-key --user-name &quot;bbl-user&quot;
</code></pre>

<p>The <code>create-access-key</code> command will write an "access key id" and "secret 
access key" to the terminal. These values are important and should
be kept secret. In the next section <code>bbl</code> will use these commands to
create infrastructure on AWS.</p>
<h3 id="creating-infrastructure-and-bosh-director">Creating infrastructure and BOSH director</h3>
<p><code>bbl</code> will create infrastructure and deploy a BOSH director with the
following command:</p>
<pre><code>bbl up \
    --aws-access-key-id &lt;INSERT ACCESS KEY ID&gt; \
    --aws-secret-access-key &lt;INSERT SECRET ACCESS KEY&gt; \
    --aws-region us-west-1 \
    --iaas aws
</code></pre>

<p>The process takes around 5-8 minutes. When the process is finished
a file named <code>bbl-state.json</code> will be created in the current working
directory. This file is very important as it contains credentials
and other metadata related to your BOSH director and infrastructure.
It is highly recommended that you backup this file into version control
or another safe location. For more info about the <code>bbl-state.json</code> see
the "State management" section.</p>
<h3 id="state-management">State management</h3>
<p>The <code>bbl-state.json</code> is an important file that contains confidential
information about your infrastructure.</p>
<p>The state file allows you to easily upgrade to the newest BOSH director
and stemcell versions when new versions of bbl are released. It will
allow you to issue a <code>bbl destroy</code> to destroy the many resources that
<code>bbl</code> creates in AWS which is much easier and less error prone
than manually finding the resources in the AWS console or CLI.</p>
<p>Backing up this file into a safe place is highly recommended. The file
should never be modified by hand.</p>
<p><code>bbl-state.json</code> contains the following:</p>
<ul>
<li>Environment ID (unique ID for tag on all resources bbl deploys)</li>
<li>BOSH director username and password</li>
<li>BOSH director IP</li>
<li>BOSH director SSL CA, certificate, private key</li>
</ul>
<p>The best way to extract this info is by issuing commands like</p>
<pre><code>$ bbl director-username
some-username
$ bbl director-ca-cert
--- BEGIN CERTIFICATE ---
...
--- END CERTIFICATE ---
</code></pre>

<p>and so on...</p>
<p>In order to run these commands, the current directory must contain the
<code>bbl-state.json</code>.</p>
<h3 id="connecting-to-the-bosh-director">Connecting to the BOSH director</h3>
<p>To setup your BOSH CLI with the new director you'll need the following
command to get the credentials:</p>
<pre><code>eval &quot;$(bbl print-env)&quot;
</code></pre>

<h4 id="alternatives-to-bbl-print-env">Alternatives to <code>bbl print-env</code></h4>
<p>Separate commands are available for the <code>bbl print-env</code> fields:</p>
<pre><code>$ bbl director-address
https://10.0.0.6:25555
$ bbl director-username
user-d3783rk
$ bbl director-password
p-23dah71skl
$ bbl director-ca-cert
-----BEGIN CERTIFICATE-----
MIIDtzCCAp+gAwIBAgIJAIPgaUgWRCE8MA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV
...
-----END CERTIFICATE-----
</code></pre>

<p>You might save the CA certificate to a file:</p>
<pre><code>$ bbl director-ca-cert &gt; bosh.crt
$ export BOSH_CA_CERT=bosh.crt
</code></pre>

<p>To login:</p>
<pre><code>$ export BOSH_ENVIRONMENT=$(bbl director-address)
$ bosh alias-env &lt;INSERT TARGET NAME&gt;
$ bosh log-in
Username: user-d3783rk
Password: p-23dah71sk1
</code></pre>

<p>Display cloud config to test setup and show configuration mapping:</p>
<pre><code>$ bosh cloud-config
...
</code></pre>

<p>Now you're ready to deploy software with BOSH!</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../credhub/" title="Accessing the BOSH director credhub" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Accessing the BOSH director credhub
              </span>
            </div>
          </a>
        
        
          <a href="../getting-started-azure/" title="Getting started azure" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Getting started azure
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.abd7b172.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>